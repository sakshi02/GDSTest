<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Polyglot AI Agent</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

    <style>
        :root { --bg: #0f172a; --panel: #1e293b; --accent: #6366f1; }

        /* Forces the page to take up the full screen */
        html, body { height: 100%; margin: 0; padding: 0; background: var(--bg); color: #f8fafc; font-family: 'Inter', sans-serif; }

        body { display: flex; flex-direction: column; overflow: hidden; }

        header {
            padding: 1rem 2rem;
            background: var(--panel);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #334155;
            height: 60px;
        }

        .container {
            display: flex;
            flex: 1;
            padding: 1rem;
            gap: 1rem;
            overflow: hidden; /* Important for internal scrolling */
        }

        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--panel);
            border-radius: 12px;
            padding: 1rem;
            min-width: 0;
        }

        textarea {
            flex: 1;
            background: #020617;
            color: #e2e8f0;
            border: 1px solid #475569;
            padding: 1rem;
            font-family: 'Fira Code', monospace;
            resize: none;
            border-radius: 8px;
            outline: none;
            overflow: auto;
            white-space: pre;
        }

        #testOutput {
            flex: 1;
            background: #020617;
            padding: 1rem;
            overflow: auto;
            border-radius: 8px;
            border: 1px solid #334155;
        }

        .btn-group { display: flex; gap: 10px; }
        button { background: var(--accent); color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-clear { background: #334155; color: #94a3b8; }
        .btn-download { background: #10b981; display: none; }

        h3 { margin: 0 0 10px 0; color: #94a3b8; font-size: 0.8rem; text-transform: uppercase; }
    </style>
</head>
<body>

<header>
    <h2 style="margin:0;">üåç Polyglot Agent</h2>
    <div class="btn-group">
        <button class="btn-clear" onclick="clearAll()">Clear</button>
        <button class="btn-download" id="downloadBtn" onclick="downloadTest()">Download</button>
        <button id="runBtn" onclick="generateTest()">Analyze & Generate</button>
    </div>
</header>

<div class="container">
    <div class="panel">
        <h3>Input Source Code</h3>
        <textarea id="codeInput" placeholder="Paste code here..."></textarea>
    </div>
    <div class="panel">
        <h3>Agent Output</h3>
        <div id="testOutput"></div>
    </div>
</div>

<script>
    function clearAll() {
        document.getElementById('codeInput').value = '';
        document.getElementById('testOutput').innerHTML = '';
        document.getElementById('downloadBtn').style.display = 'none';
    }

    async function generateTest() {
        const input = document.getElementById('codeInput').value;
        const outputDiv = document.getElementById('testOutput');
        if (!input.trim()) return;

        outputDiv.innerHTML = "<p>ü§ñ Agent is thinking...</p>";

        try {
            const response = await fetch('/generate-test', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code: input })
            });
            const data = await response.text();
            outputDiv.innerHTML = marked.parse(data);
            Prism.highlightAllUnder(outputDiv);
            document.getElementById('downloadBtn').style.display = 'inline-block';
        } catch (error) {
            outputDiv.innerHTML = "<p style='color:red;'>Error connecting to server.</p>";
        }
    }

    function downloadTest() {
        const codeElement = document.querySelector('#testOutput pre code');
        if (!codeElement) return;
        const blob = new Blob([codeElement.innerText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "GeneratedTest.txt";
        a.click();
    }
</script>
</body>
</html>